---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getImage } from 'astro:assets';
import { getCollection } from 'astro:content';
import ogImage from '../assets/og-image.jpg';

const allServices = await getCollection('services');
// Periodic Inspections first, then the rest (alphabetically by id); take first 6 for home summary
const servicesSorted = [
	...allServices.filter((s) => s.id === 'periodic-inspections'),
	...allServices.filter((s) => s.id !== 'periodic-inspections').sort((a, b) => a.id.localeCompare(b.id)),
];
const featuredServices = servicesSorted.slice(0, 6);
const testimonials = await getCollection('testimonials');
const featuredTestimonials = testimonials.slice(0, 3);

const ogOptimized = getImage({ src: ogImage, width: 1200, height: 630 });
---

<BaseLayout title="Home" description="Quan Electrical — Powering homes, businesses & industry. Domestic, commercial & industrial. Full installations, fault finding, EV chargers, emergency callouts. Covering Kilkenny & surrounding areas." image={ogOptimized.src}>
	<!-- Hero — full impact -->
	<section class="relative overflow-hidden bg-slate-900">
		<div class="absolute inset-0 bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(251,191,36,0.15),transparent)]" aria-hidden="true"></div>
		<div class="absolute inset-0 bg-[linear-gradient(to_right,#3341550a_1px,transparent_1px),linear-gradient(to_bottom,#3341550a_1px,transparent_1px)] bg-[size:4rem_4rem]" aria-hidden="true"></div>
		<div class="container relative mx-auto px-4 py-16 sm:px-6 sm:py-24 md:py-32 lg:px-8">
			<div class="max-w-3xl">
				<p class="font-heading text-sm font-semibold uppercase tracking-[0.2em] text-amber-400">Kilkenny & surrounding areas</p>
				<h1 class="font-heading mt-4 text-3xl font-extrabold tracking-tight text-white sm:text-5xl md:text-6xl lg:text-7xl">
					Powering homes,<br />businesses & industry
				</h1>
				<p class="mt-5 text-base text-slate-300 sm:mt-6 sm:text-lg md:text-xl">
					Periodic inspections, full electrical installations, fault finding, fuse board upgrades, EV chargers & emergency callouts. Domestic | Commercial | Industrial.
				</p>
				<p class="mt-4 flex flex-wrap gap-4 text-slate-400">
					<span class="font-medium text-amber-400/90">Reliable.</span>
					<span class="font-medium text-amber-400/90">Professional.</span>
					<span class="font-medium text-amber-400/90">Local.</span>
				</p>
				<div class="mt-10 flex flex-col gap-3 sm:mt-12 sm:flex-row sm:flex-wrap sm:gap-4">
					<a href="/contact" class="inline-flex min-h-[48px] items-center justify-center rounded-xl bg-amber-500 px-6 py-3.5 font-heading text-base font-semibold text-slate-900 shadow-lg shadow-amber-500/25 transition hover:bg-amber-400 active:bg-amber-400 sm:px-8 sm:py-4">
						Contact us today
					</a>
					<a href="/services" class="inline-flex min-h-[48px] items-center justify-center rounded-xl border-2 border-slate-500/50 px-6 py-3.5 font-heading text-base font-semibold text-white transition hover:border-amber-400/50 hover:text-amber-400 active:border-amber-400/50 active:text-amber-400 sm:px-8 sm:py-4">
						Our services
					</a>
				</div>
			</div>
		</div>
	</section>

	<!-- Services — refined cards -->
	<section class="py-12 sm:py-20 md:py-28">
		<div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
			<div class="max-w-2xl">
				<p class="font-heading text-sm font-semibold uppercase tracking-wider text-amber-600">What we do</p>
				<h2 class="font-heading mt-2 text-2xl font-bold tracking-tight text-slate-900 sm:text-4xl">Our services</h2>
				<p class="mt-4 text-lg text-slate-600">
					Periodic inspections, full electrical installations, fault finding & repairs, lighting & power, fuse board upgrades, EV chargers & emergency callouts.
				</p>
			</div>
			<div class="mt-10 grid gap-6 sm:mt-16 sm:gap-8 sm:grid-cols-2 lg:grid-cols-3">
				{featuredServices.map((service) => (
					<a href={`/services/${service.id}`} class="group relative overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm transition hover:border-amber-200 hover:shadow-xl hover:shadow-amber-500/5">
						<div class="aspect-[4/3] overflow-hidden">
							{service.data.image && (
								<img
									src={service.data.image}
									alt={`${service.data.title} — Quan Electrical, Kilkenny`}
									width={800}
									height={500}
									class="h-full w-full object-cover transition duration-500 group-hover:scale-105"
									loading="lazy"
									decoding="async"
								/>
							)}
							<div class="absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-transparent opacity-0 transition group-hover:opacity-100" aria-hidden="true"></div>
						</div>
						<div class="p-6">
							<h3 class="font-heading text-xl font-semibold text-slate-900 group-hover:text-amber-700 transition">{service.data.title}</h3>
							<p class="mt-2 text-slate-600 line-clamp-2 text-sm leading-relaxed">{service.data.summary}</p>
							<span class="mt-4 inline-flex items-center gap-1 text-sm font-semibold text-amber-600 group-hover:gap-2 transition-all">
								Learn more
								<span aria-hidden="true">→</span>
							</span>
						</div>
					</a>
				))}
			</div>
			<div class="mt-14 text-center">
				<a href="/services" class="inline-flex items-center gap-2 font-semibold text-amber-600 hover:text-amber-700">
					View all services
					<span aria-hidden="true">→</span>
				</a>
			</div>
		</div>
	</section>

	<!-- Testimonials — elegant blocks -->
	<section class="bg-slate-900 py-12 sm:py-20 md:py-28">
		<div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
			<div class="max-w-2xl">
				<p class="font-heading text-sm font-semibold uppercase tracking-wider text-amber-400">Testimonials</p>
				<h2 class="font-heading mt-2 text-2xl font-bold tracking-tight text-white sm:text-4xl">What our customers say</h2>
				<p class="mt-4 text-slate-400">Trusted by homeowners and businesses across Kilkenny.</p>
			</div>
			<div class="mt-10 grid gap-6 sm:mt-16 sm:gap-8 md:grid-cols-3">
				{featuredTestimonials.map((t) => (
					<blockquote class="rounded-2xl border border-slate-700/50 bg-slate-800/50 p-6 backdrop-blur sm:p-8">
						<div class="flex gap-1 text-amber-400">
							{Array.from({ length: t.data.rating ?? 5 }).map(() => '★')}
						</div>
						<p class="mt-5 text-slate-300 leading-relaxed">"{t.data.quote}"</p>
						<footer class="mt-6">
							<p class="font-semibold text-white">{t.data.name}</p>
							{t.data.town && <p class="text-sm text-slate-500">{t.data.town}</p>}
						</footer>
					</blockquote>
				))}
			</div>
		</div>
	</section>

	<!-- CTA — bold close -->
	<section class="py-12 sm:py-20 md:py-28">
		<div class="container mx-auto max-w-3xl px-4 text-center sm:px-6 lg:px-8">
			<h2 class="font-heading text-2xl font-bold tracking-tight text-slate-900 sm:text-4xl">Contact us today</h2>
			<p class="mt-4 text-base font-semibold text-slate-700 sm:text-lg">Reliable. Professional. Local.</p>
			<p class="mt-2 text-slate-600">Covering Kilkenny & surrounding areas. Free quotes. No obligation.</p>
			<div class="mt-8 flex flex-col gap-3 sm:mt-10 sm:flex-row sm:flex-wrap sm:justify-center sm:gap-4">
				<a href="/contact" class="inline-flex min-h-[48px] items-center justify-center rounded-xl bg-amber-500 px-6 py-3.5 font-heading font-semibold text-slate-900 shadow-lg shadow-amber-500/20 transition hover:bg-amber-400 active:bg-amber-400 sm:px-8 sm:py-4">Contact us</a>
				<a href="/projects" class="inline-flex min-h-[48px] items-center justify-center rounded-xl border-2 border-slate-300 px-6 py-3.5 font-heading font-semibold text-slate-700 transition hover:border-amber-400 hover:text-amber-700 active:border-amber-400 active:text-amber-700 sm:px-8 sm:py-4">View our work</a>
			</div>
		</div>
	</section>
</BaseLayout>
