---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntry, getCollection } from 'astro:content';
import { render } from 'astro:content';

export async function getStaticPaths() {
	const services = await getCollection('services');
	return services.map((entry) => ({ params: { slug: entry.id } }));
}

const { slug: rawSlug } = Astro.params;
const slug = Array.isArray(rawSlug) ? rawSlug[0] : rawSlug;
const service = slug ? await getEntry('services', slug) : null;

if (!service) {
	return Astro.redirect('/services');
}

const { Content } = await render(service);
---

<BaseLayout title={service.data.title} description={service.data.summary} image={service.data.image}>
	<article class="py-20 md:py-28">
		<div class="container mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
			<header>
				{service.data.image && (
					<div class="overflow-hidden rounded-2xl border border-slate-200 shadow-xl">
						<img
							src={service.data.image}
							alt={`${service.data.title} â€” Quan Electrical, Kilkenny`}
							width={800}
							height={400}
							class="w-full object-cover"
							style="max-height: 400px;"
							loading="eager"
							decoding="async"
						/>
					</div>
				)}
				<h1 class="font-heading mt-8 text-4xl font-bold tracking-tight text-slate-900 md:text-5xl">{service.data.title}</h1>
				<p class="mt-4 text-lg text-slate-600">{service.data.summary}</p>
				{service.data.pricingNotes && (
					<p class="mt-3 font-medium text-amber-600">{service.data.pricingNotes}</p>
				)}
			</header>
			<div class="prose prose-slate prose-lg mt-12 max-w-none prose-headings:font-semibold prose-a:text-amber-600 prose-a:no-underline hover:prose-a:text-amber-700">
				<Content />
			</div>
			<p class="mt-14">
				<a href="/contact" class="inline-flex rounded-xl bg-amber-500 px-8 py-4 font-heading font-semibold text-slate-900 shadow-sm transition hover:bg-amber-400">Get a quote</a>
			</p>
		</div>
	</article>
</BaseLayout>
